// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.977
package api

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import "fmt"

func Dashboard(port int, status Status) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<!doctype html><html><head><title>Cheetah Dashboard</title><meta charset=\"utf-8\"><style>\n\t\t\t\tbody { font-family: system-ui, sans-serif; margin: 2rem; background: #0a0a0a; color: #e0e0e0; }\n\t\t\t\th1 { color: #f0f0f0; }\n\t\t\t\t.status { background: #1a1a2e; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; }\n\t\t\t\t.status span { margin-right: 2rem; }\n\t\t\t\t.dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 4px; }\n\t\t\t\t.dot.on { background: #4ade80; }\n\t\t\t\t.dot.off { background: #ef4444; }\n\t\t\t\ttable { width: 100%; border-collapse: collapse; }\n\t\t\t\tth, td { text-align: left; padding: 0.5rem 1rem; border-bottom: 1px solid #2a2a3e; }\n\t\t\t\tth { color: #888; font-weight: 500; font-size: 0.85rem; text-transform: uppercase; }\n\t\t\t\ttr:hover { background: #1a1a2e; }\n\t\t\t\t.active-port { color: #4ade80; font-weight: 600; }\n\t\t\t\ta { color: #7dd3fc; text-decoration: none; }\n\t\t\t\ta:hover { text-decoration: underline; }\n\t\t\t\tcode { background: #1a1a2e; padding: 2px 6px; border-radius: 4px; font-size: 0.85rem; }\n\t\t\t\t.empty { text-align: center; padding: 3rem; color: #666; }\n\t\t\t\t#env-section { margin-top: 2rem; }\n\t\t\t\t#env-section h2 { color: #f0f0f0; font-size: 1.2rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 1rem; }\n\t\t\t\t.env-group { background: #1a1a2e; border-radius: 8px; margin-bottom: 1rem; overflow: hidden; }\n\t\t\t\t.env-group-header { padding: 0.75rem 1rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; user-select: none; }\n\t\t\t\t.env-group-header:hover { background: #2a2a3e; }\n\t\t\t\t.env-group-header .arrow { transition: transform 0.2s; font-size: 0.7rem; color: #888; }\n\t\t\t\t.env-group-header .arrow.open { transform: rotate(90deg); }\n\t\t\t\t.env-group-header .app-name { font-weight: 600; }\n\t\t\t\t.env-group-header .count { color: #888; font-size: 0.85rem; margin-left: auto; }\n\t\t\t\t.env-group-body { display: none; padding: 0 1rem 0.75rem; }\n\t\t\t\t.env-group-body.open { display: block; }\n\t\t\t\t.env-textarea { width: 100%; min-height: 120px; background: #0a0a0a; border: 1px solid #2a2a3e; color: #e0e0e0; padding: 0.6rem; border-radius: 4px; font: 0.85rem/1.4 monospace; resize: vertical; box-sizing: border-box; }\n\t\t\t\t.env-textarea:focus { border-color: #4a4a6e; outline: none; }\n\t\t\t\t.env-btn { background: #2a2a3e; border: 1px solid #3a3a4e; color: #e0e0e0; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem; }\n\t\t\t\t.env-btn:hover { background: #3a3a4e; }\n\t\t\t\t.env-btn.danger { color: #ef4444; }\n\t\t\t\t.env-btn.danger:hover { background: #3a1a1a; }\n\t\t\t\t.env-actions { display: flex; gap: 0.5rem; margin-top: 0.5rem; }\n\t\t\t\t.env-saved { color: #4ade80; font-size: 0.85rem; opacity: 0; transition: opacity 0.3s; }\n\t\t\t\t.env-saved.show { opacity: 1; }\n\t\t\t\t.env-modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 10000; display: flex; align-items: center; justify-content: center; }\n\t\t\t\t.env-modal { background: #1a1a2e; border: 1px solid #2a2a3e; border-radius: 8px; padding: 1.5rem; width: 480px; max-width: 90vw; }\n\t\t\t\t.env-modal h3 { margin: 0 0 1rem; color: #f0f0f0; font-size: 1.1rem; }\n\t\t\t\t.env-modal label { display: block; color: #888; font-size: 0.85rem; margin-bottom: 0.3rem; }\n\t\t\t\t.env-modal input, .env-modal textarea { width: 100%; box-sizing: border-box; background: #0a0a0a; border: 1px solid #2a2a3e; color: #e0e0e0; padding: 0.5rem; border-radius: 4px; font: 0.85rem/1.4 monospace; margin-bottom: 0.75rem; }\n\t\t\t\t.env-modal textarea { min-height: 100px; resize: vertical; }\n\t\t\t\t.env-modal-actions { display: flex; gap: 0.5rem; justify-content: flex-end; }\n\t\t\t\t.env-modal .env-error { color: #ef4444; font-size: 0.85rem; margin-bottom: 0.5rem; min-height: 1.2em; }\n\t\t\t</style></head><body><h1>Cheetah</h1><div class=\"status\" id=\"status-bar\"><span>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		if status.PostgresRunning {
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, "<span class=\"dot on\"></span> ")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
		} else {
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 3, "<span class=\"dot off\"></span> ")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 4, "Postgres :")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var2 string
		templ_7745c5c3_Var2, templ_7745c5c3_Err = templ.JoinStringErrs(fmt.Sprint(status.PostgresPort))
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `dashboard.templ`, Line: 67, Col: 48}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var2))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 5, "</span> <span>Apps: <span id=\"app-count\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var3 string
		templ_7745c5c3_Var3, templ_7745c5c3_Err = templ.JoinStringErrs(fmt.Sprint(status.AppCount))
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `dashboard.templ`, Line: 69, Col: 66}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var3))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 6, "</span></span> <span style=\"margin-left:auto; color:#888; font-size:0.85rem;\">")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var4 string
		templ_7745c5c3_Var4, templ_7745c5c3_Err = templ.JoinStringErrs(status.Version)
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `dashboard.templ`, Line: 70, Col: 83}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var4))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 7, "</span></div><div id=\"app-table\"></div><div id=\"env-section\"></div>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templ.Raw(dashboardJS).Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 8, "<script src=\"/spaces.js\" data-space=\"cheetah\" data-port=\"")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var5 string
		templ_7745c5c3_Var5, templ_7745c5c3_Err = templ.JoinStringErrs(fmt.Sprint(port))
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `dashboard.templ`, Line: 75, Col: 77}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var5))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 9, "\" data-version=\"")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		var templ_7745c5c3_Var6 string
		templ_7745c5c3_Var6, templ_7745c5c3_Err = templ.JoinStringErrs(status.Version)
		if templ_7745c5c3_Err != nil {
			return templ.Error{Err: templ_7745c5c3_Err, FileName: `dashboard.templ`, Line: 75, Col: 109}
		}
		_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var6))
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 10, "\"></script></body></html>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

const dashboardJS = `<script>
(function() {
  const table = document.getElementById("app-table");
  const countEl = document.getElementById("app-count");
  let apps = {};

  function render() {
    const list = Object.values(apps);
    countEl.textContent = list.length;
    if (list.length === 0) {
      table.innerHTML = '<div class="empty">No apps registered. Run <code>go run main.go</code> in a child app to register.</div>';
      return;
    }
    let h = '<table><thead><tr>' +
      '<th>Space</th><th>App</th><th>Config</th>' +
      '<th>Blue</th><th>Green</th>' +
      '<th>Watch</th><th>Logs</th></tr></thead><tbody>';
    for (const a of list) {
      const watchPats = (a.watch.match || []).slice().sort();
      const wildExts = [], other = [];
      for (const p of watchPats) {
        const m = p.match(/^\*\.(\w+)$/);
        if (m) wildExts.push(m[1]);
        else other.push(p);
      }
      if (wildExts.length > 1) other.unshift('*.{' + wildExts.join(',') + '}');
      else if (wildExts.length === 1) other.unshift('*.' + wildExts[0]);
      const watch = other.map(p => '<code>' + p + '</code>').join(' ');
      const parts = (a.dir || '').split('/');
      let appName = parts.pop() || '';
      if (appName === a.space && parts.length > 0) appName = parts.pop() || '';
      const healthy = a.health && a.health.status === 'healthy';
      const p1cls = healthy && a.ports.active === a.ports.blue ? ' class="active-port"' : '';
      const p2cls = healthy && a.ports.active === a.ports.green ? ' class="active-port"' : '';
      h += '<tr>' +
        '<td><strong><a href="' + location.protocol + '//' + a.space + '.localhost:' + location.port + '/">' + a.space + '</a></strong></td>' +
        '<td><code>' + appName + '</code></td>' +
        '<td>' + (a.config || []).map(c => '<code>' + c + '</code>').join(' ') + '</td>' +
        '<td' + p1cls + '>:' + a.ports.blue + '</td>' +
        '<td' + p2cls + '>:' + a.ports.green + '</td>' +
        '<td>' + watch + '</td>' +
        '<td>' + (a.logs || []).length + '</td></tr>';
    }
    h += '</tbody></table>';
    table.innerHTML = h;
  }

  const es = new EventSource("/api/events");

  es.addEventListener("init", function(e) {
    const list = JSON.parse(e.data);
    apps = {};
    for (const a of list) apps[a.space] = a;
    render();
  });

  es.addEventListener("app", function(e) {
    const a = JSON.parse(e.data);
    apps[a.space] = a;
    render();
  });

  es.addEventListener("deregister", function(e) {
    const data = JSON.parse(e.data);
    delete apps[data.space];
    render();
  });

  render();

  // Env editor
  const envSection = document.getElementById("env-section");
  let envData = {};
  let openGroups = {};

  function fetchEnv() {
    fetch("/api/env").then(r => r.json()).then(data => {
      envData = data || {};
      renderEnv();
    });
  }

  function varsToText(vars) {
    return Object.keys(vars).sort().map(k => k + "=" + vars[k]).join("\n");
  }

  function textToVars(text) {
    const vars = {};
    for (const line of text.split("\n")) {
      const trimmed = line.trim();
      if (!trimmed || trimmed.startsWith("#")) continue;
      const raw = trimmed.replace(/^export\s+/, "");
      const idx = raw.indexOf("=");
      if (idx < 0) continue;
      const k = raw.substring(0, idx).trim();
      let v = raw.substring(idx + 1).trim();
      if ((v.startsWith('"') && v.endsWith('"')) || (v.startsWith("'") && v.endsWith("'"))) {
        v = v.slice(1, -1);
      }
      if (k) vars[k] = v;
    }
    return vars;
  }

  function saveEnv(app, vars) {
    fetch("/api/env/" + encodeURIComponent(app), {
      method: "PUT",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(vars)
    });
  }

  function renderEnv() {
    const groups = Object.keys(envData).sort();
    let h = '<h2>Configs <button class="env-btn" onclick="addEnvGroup()">+ App</button> <button class="env-btn" onclick="showImportModal()">Import</button></h2>';
    if (groups.length === 0) {
      h += '<div class="empty">No environment variables configured.</div>';
      envSection.innerHTML = h;
      return;
    }
    for (const app of groups) {
      const vars = envData[app] || {};
      const keys = Object.keys(vars);
      const isOpen = openGroups[app];
      h += '<div class="env-group">';
      h += '<div class="env-group-header" onclick="toggleEnvGroup(\'' + app + '\')">';
      h += '<span class="arrow' + (isOpen ? ' open' : '') + '">&#9654;</span>';
      h += '<span class="app-name">' + app + '</span>';
      h += '<span class="count">' + keys.length + ' var' + (keys.length !== 1 ? 's' : '') + '</span>';
      h += '</div>';
      h += '<div class="env-group-body' + (isOpen ? ' open' : '') + '">';
      h += '<textarea class="env-textarea" data-app="' + app + '" spellcheck="false" placeholder="KEY=value&#10;export SECRET=hunter2">' + varsToText(vars) + '</textarea>';
      h += '<div class="env-actions">';
      h += '<button class="env-btn" onclick="saveEnvGroup(\'' + app + '\')">Save</button>';
      h += '<button class="env-btn" onclick="showExportModal(\'' + app + '\')">Export</button>';
      h += '<button class="env-btn danger" onclick="deleteEnvGroup(\'' + app + '\')">&times; Remove App</button>';
      h += '<span class="env-saved" id="env-saved-' + app + '">Saved</span>';
      h += '</div>';
      h += '</div></div>';
    }
    envSection.innerHTML = h;
  }

  window.toggleEnvGroup = function(app) {
    openGroups[app] = !openGroups[app];
    renderEnv();
  };

  window.saveEnvGroup = function(app) {
    const ta = envSection.querySelector('textarea[data-app="' + app + '"]');
    if (!ta) return;
    const vars = textToVars(ta.value);
    envData[app] = vars;
    saveEnv(app, vars);
    const badge = document.getElementById("env-saved-" + app);
    if (badge) { badge.classList.add("show"); setTimeout(() => badge.classList.remove("show"), 1500); }
  };

  window.deleteEnvGroup = function(app) {
    delete envData[app];
    delete openGroups[app];
    saveEnv(app, {});
    renderEnv();
  };

  window.addEnvGroup = function() {
    const app = prompt("App name (e.g. auth, greet):");
    if (!app) return;
    if (!envData[app]) envData[app] = {};
    openGroups[app] = true;
    renderEnv();
  };

  function showFlash(msg, opts) {
    opts = opts || {};
    var el = document.createElement("div");
    el.style.cssText = "position:fixed;top:1rem;right:1rem;background:#1a1a2e;border:1px solid #4ade80;color:#4ade80;padding:0.6rem 1.2rem;border-radius:6px;font:0.85rem/1.6 system-ui;z-index:10001;display:flex;align-items:flex-start;gap:0.75rem;max-width:400px;";
    var text = document.createElement("div");
    text.innerHTML = msg;
    el.appendChild(text);
    var close = document.createElement("button");
    close.textContent = "\u00d7";
    close.style.cssText = "background:none;border:none;color:#4ade80;font-size:1.2rem;cursor:pointer;padding:0;line-height:1;flex-shrink:0;";
    close.onclick = function() { el.remove(); };
    el.appendChild(close);
    document.body.appendChild(el);
    if (!opts.sticky) {
      setTimeout(function() { el.style.opacity = "0"; el.style.transition = "opacity 0.3s"; setTimeout(function() { el.remove(); }, 300); }, 2000);
    }
  }

  var passphraseWords = [
    "acorn","alpine","amber","anchor","apple","arrow","atlas","autumn",
    "badge","baker","barn","basin","beach","beacon","birch","blade",
    "bloom","bluff","board","bolt","bonus","booth","brave","breeze",
    "brick","bridge","brook","brush","cabin","cairn","candy","cargo",
    "cedar","chalk","chase","chess","chief","cider","claim","cliff",
    "cloud","clover","coach","coast","coral","crane","creek","crest",
    "crown","crystal","curve","dagger","daisy","dawn","delta","depot",
    "diver","dock","drift","drum","dune","eagle","ember","entry",
    "epoch","fable","falcon","fern","ferry","field","finch","flame",
    "flare","flask","flint","flora","forge","frost","gale","garden",
    "gate","gem","ghost","glade","gleam","globe","gorge","grain",
    "grove","guild","haven","hawk","hazel","hearth","hedge","heron",
    "honey","hover","ivory","jade","jewel","joint","karma","kayak",
    "lance","latch","lemon","light","lilac","linen","lodge","lunar",
    "maple","marsh","mason","medal","melon","mesa","midge","mirth",
    "moose","mound","noble","north","novel","oasis","olive","orbit",
    "otter","oxide","panda","patch","pearl","pebble","penny","perch",
    "pilot","pine","plank","plaza","plume","polar","pond","prism",
    "pulse","quail","quarry","quest","quilt","raven","ridge","river",
    "robin","rover","royal","sage","scale","scout","shaft","shell",
    "shore","shrub","silk","slate","slope","solar","spark","spire",
    "spray","stamp","steel","stone","storm","stove","surge","swift",
    "table","talon","thorn","tidal","tiger","torch","tower","trail",
    "tulip","umbra","unity","valve","vault","velvet","verse","vigor",
    "viola","vivid","waltz","wheat","whirl","willow","woven","yacht",
    "yield","zebra","zephyr","zone"
  ];

  window.generatePassphrase = function() {
    var arr = new Uint32Array(4);
    crypto.getRandomValues(arr);
    return Array.from(arr).map(function(n) { return passphraseWords[n % passphraseWords.length]; }).join(" ");
  }

  window.showExportModal = function(app) {
    var phrase = generatePassphrase();
    var overlay = document.createElement("div");
    overlay.className = "env-modal-overlay";
    overlay.innerHTML = '<div class="env-modal">' +
      '<h3>Export: ' + app + '</h3>' +
      '<label>Passphrase <span style="color:#666;font-size:0.8rem">(share separately with your teammate)</span></label>' +
      '<div style="display:flex;gap:0.5rem;margin-bottom:0.75rem">' +
      '<input type="text" id="export-pass" value="' + phrase + '" aria-label="Export passphrase" style="margin-bottom:0" data-1p-ignore autocomplete="off" />' +
      '<button class="env-btn" onclick="document.getElementById(\'export-pass\').value=generatePassphrase()" style="white-space:nowrap" aria-label="Regenerate passphrase">&#x21bb;</button>' +
      '</div>' +
      '<div class="env-error" id="export-error"></div>' +
      '<div class="env-modal-actions">' +
      '<button class="env-btn" onclick="this.closest(\'.env-modal-overlay\').remove()">Cancel</button>' +
      '<button class="env-btn" onclick="doExport(\'' + app + '\')">Export &amp; Copy</button>' +
      '</div></div>';
    document.body.appendChild(overlay);
    overlay.querySelector("#export-pass").select();
    overlay.addEventListener("click", function(e) { if (e.target === overlay) overlay.remove(); });
  };

  window.doExport = function(app) {
    var pass = document.getElementById("export-pass").value;
    var errEl = document.getElementById("export-error");
    if (!pass) { errEl.textContent = "Passphrase is required"; return; }
    errEl.textContent = "";
    fetch("/api/env/export", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({app: app, passphrase: pass})
    }).then(function(r) { return r.json(); }).then(function(data) {
      if (data.error) { errEl.textContent = data.error; return; }
      navigator.clipboard.writeText(data.blob).then(function() {
        document.querySelector(".env-modal-overlay").remove();
        showFlash("Encrypted config copied to clipboard<br>Passphrase: <code style=\"background:#0a0a0a;padding:2px 6px;border-radius:4px;color:#e0e0e0\">" + pass + "</code>", {sticky: true});
      }).catch(function() {
        errEl.textContent = "";
        var modal = document.querySelector(".env-modal");
        modal.innerHTML = '<h3>Export: ' + app + '</h3>' +
          '<label>Encrypted blob (copy this)</label>' +
          '<textarea readonly onclick="this.select()" aria-label="Encrypted config blob">' + data.blob + '</textarea>' +
          '<div class="env-modal-actions">' +
          '<button class="env-btn" onclick="this.closest(\'.env-modal-overlay\').remove()">Close</button></div>';
      });
    });
  };

  window.showImportModal = function() {
    var overlay = document.createElement("div");
    overlay.className = "env-modal-overlay";
    overlay.innerHTML = '<div class="env-modal">' +
      '<h3>Import Config</h3>' +
      '<label>Encrypted blob</label>' +
      '<textarea id="import-blob" placeholder="Paste the cheetah:v1:... blob here" aria-label="Encrypted config blob"></textarea>' +
      '<label>Passphrase</label>' +
      '<input type="text" id="import-pass" placeholder="Enter the shared passphrase" aria-label="Import passphrase" data-1p-ignore autocomplete="off" />' +
      '<div class="env-error" id="import-error"></div>' +
      '<div class="env-modal-actions">' +
      '<button class="env-btn" onclick="this.closest(\'.env-modal-overlay\').remove()">Cancel</button>' +
      '<button class="env-btn" onclick="doImport()">Import</button>' +
      '</div></div>';
    document.body.appendChild(overlay);
    overlay.querySelector("#import-blob").focus();
    overlay.addEventListener("click", function(e) { if (e.target === overlay) overlay.remove(); });
  };

  window.doImport = function() {
    var blob = document.getElementById("import-blob").value.trim();
    var pass = document.getElementById("import-pass").value;
    var errEl = document.getElementById("import-error");
    if (!blob || !pass) { errEl.textContent = "Both fields are required"; return; }
    errEl.textContent = "";
    fetch("/api/env/import", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({blob: blob, passphrase: pass})
    }).then(function(r) { return r.json(); }).then(function(data) {
      if (data.error) { errEl.textContent = data.error; return; }
      document.querySelector(".env-modal-overlay").remove();
      envData[data.app] = data.vars;
      openGroups[data.app] = true;
      renderEnv();
      showFlash("Imported " + Object.keys(data.vars).length + " vars for " + data.app);
    });
  };

  es.addEventListener("env", function(e) {
    const data = JSON.parse(e.data);
    if (data.vars && Object.keys(data.vars).length > 0) {
      envData[data.app] = data.vars;
    } else {
      delete envData[data.app];
    }
    renderEnv();
  });

  fetchEnv();
})();
</script>`

var _ = templruntime.GeneratedTemplate
